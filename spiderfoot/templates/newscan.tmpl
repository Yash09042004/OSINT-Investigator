<%include file="HEADER.tmpl"/>
<script src="${docroot}/static/js/spiderfoot.newscan.js"></script>
<div class="main-content">
    <div class="header-section">
        <h2><i class="fas fa-plus-circle"></i> New Scan</h2>
        <p class="subtitle">Configure and launch a new OSINT investigation</p>
    </div>
    
    <div class="scan-form-container">
        <form class="modern-form" action='${docroot}/startscan' method='POST'>
            <div class="form-grid">
                <div class='form-left'>
                    <div class="form-group">
                        <label for="scanname"><i class="fas fa-tag"></i> Scan Name</label>
                        <input class='form-control' type="text" id="scanname" name="scanname" value="${scanname}" placeholder="Enter a descriptive name for this scan">
                    </div>
                    <div class="form-group">
                        <label for="scantarget"><i class="fas fa-crosshairs"></i> Scan Target</label>
                        <input class='form-control' type="text" value="${scantarget}" id="scantarget" name="scantarget" placeholder="Enter your investigation target">
                    </div>
                </div>
                
                <div class='form-right'>
                    <div class='info-card'>
                        <div class='info-header'>
                            <i class='fas fa-info-circle'></i>
                            <span>Supported Target Types</span>
                        </div>
                        <div class='info-content'>
                            <div class='target-types'>
                                <div class='type-column'>
                                    <div class='target-type'>
                                        <strong>Domain Name</strong>
                                        <code>example.com</code>
                                    </div>
                                    <div class='target-type'>
                                        <strong>IPv4 Address</strong>
                                        <code>192.168.1.1</code>
                                    </div>
                                    <div class='target-type'>
                                        <strong>IPv6 Address</strong>
                                        <code>2606:4700::1111</code>
                                    </div>
                                    <div class='target-type'>
                                        <strong>Hostname</strong>
                                        <code>subdomain.example.com</code>
                                    </div>
                                    <div class='target-type'>
                                        <strong>Subnet</strong>
                                        <code>192.168.1.0/24</code>
                                    </div>
                                    <div class='target-type'>
                                        <strong>Bitcoin Address</strong>
                                        <code>1A1zP1e...</code>
                                    </div>
                                </div>
                                <div class='type-column'>
                                    <div class='target-type'>
                                        <strong>Email Address</strong>
                                        <code>user@example.com</code>
                                    </div>
                                    <div class='target-type'>
                                        <strong>Phone Number</strong>
                                        <code>+12345678901</code>
                                    </div>
                                    <div class='target-type'>
                                        <strong>Human Name</strong>
                                        <code>"John Smith"</code>
                                    </div>
                                    <div class='target-type'>
                                        <strong>Username</strong>
                                        <code>"jsmith2000"</code>
                                    </div>
                                    <div class='target-type'>
                                        <strong>Network ASN</strong>
                                        <code>AS1234</code>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="module-selection">
                <div class="tabs-container">
                    <ul class='nav nav-tabs modern-tabs'>
                        <li id='usetab' class="active"><a href='#'><i class="fas fa-bullseye"></i> Use Case</a></li>
                        <li id='typetab'><a href='#'><i class="fas fa-database"></i> Data Types</a></li>
                        <li id='moduletab'><a href='#'><i class="fas fa-puzzle-piece"></i> Modules</a></li>
                        <div class='action-buttons pull-right' id='selectors' style='display: none'>
                            <button id="btn-select-all" type="button" class="btn btn-outline">Select All</button>
                            <button id="btn-deselect-all" type="button" class="btn btn-outline">Deselect All</button>
                        </div>
                    </ul>
                </div>
                
                <div class="tab-content-container">
                    <table class="modern-table" id="usetable">
                        <tr class="use-case-row">
                            <td class="radio-cell">
                                <input type="radio" name='usecase' value='all' id="usecase_all" checked>
                            </td>
                            <td class="use-case-name">
                                <div class="use-case-title">
                                    <i class="fas fa-globe"></i>
                                    <strong>Complete Investigation</strong>
                                </div>
                            </td>
                            <td class="use-case-description">
                                <strong>Comprehensive analysis of the target</strong><br>
                                All OSINT Investigator modules will be enabled (slower but thorough). Every possible piece of information about the target will be obtained and analyzed.
                            </td>
                        </tr>
                        <tr class="use-case-row">
                            <td class="radio-cell">
                                <input type="radio" name='usecase' value='Footprint' id="usecase_footprint">
                            </td>
                            <td class="use-case-name">
                                <div class="use-case-title">
                                    <i class="fas fa-shoe-prints"></i>
                                    <strong>Digital Footprint</strong>
                                </div>
                            </td>
                            <td class="use-case-description">
                                <strong>Map the target's digital presence</strong><br>
                                Understand the target's network perimeter, associated identities, and publicly exposed information through web crawling and search engines.
                            </td>
                        </tr>
                        <tr class="use-case-row">
                            <td class="radio-cell">
                                <input type="radio" name='usecase' value='Investigate' id="usecase_investigate">
                            </td>
                            <td class="use-case-name">
                                <div class="use-case-title">
                                    <i class="fas fa-search"></i>
                                    <strong>Threat Investigation</strong>
                                </div>
                            </td>
                            <td class="use-case-description">
                                <strong>Investigate potentially malicious targets</strong><br>
                                Combines basic footprinting with blacklist queries and threat intelligence sources to assess target maliciousness.
                            </td>
                        </tr>
                        <tr class="use-case-row">
                            <td class="radio-cell">
                                <input type="radio" name='usecase' value='Passive' id="usecase_passive">
                            </td>
                            <td class="use-case-name">
                                <div class="use-case-title">
                                    <i class="fas fa-user-secret"></i>
                                    <strong>Passive Reconnaissance</strong>
                                </div>
                            </td>
                            <td class="use-case-description">
                                <strong>Stealth investigation mode</strong><br>
                                Information gathering without directly contacting the target or affiliates. Only passive intelligence sources are used.                            </td>
                        </tr>
                    </table>

                    <table class="modern-table module-table" id="moduletable" style="display: none">
                        <thead>
                            <tr>
                                <th style="width: 50px;"><i class="fas fa-check"></i></th>
                                <th><i class="fas fa-puzzle-piece"></i> Module</th>
                                <th><i class="fas fa-info-circle"></i> Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <%
                            modlist = dict()
                            for item in modules:
                                modlist[modules[item]['name']] = item
                            %>
                            % for it in sorted(modlist, key=lambda v: v.upper()):
                                <% item = modlist[it] %>
                                <% keylist = dict((k, v) for k, v in modules[item]['opts'].items() if not k.startswith('_')) %>
                                <% keyicon = "" %>
                                % if len(keylist) > 0:
                                    <% apikeylist = dict((k, v) for k, v in modules[item]['opts'].items() if k.find("api_key") >= 0) %>
                                    <%
                                    if len(apikeylist) > 0:
                                        keyicon = "&nbsp;&nbsp;<i class=\"fas fa-key\" rel='tooltip' title='Requires API key'></i>"
                                    %>
                                % endif

                                % if item != "sfp__stor_db" and item != "sfp__stor_stdout":
                                    <tr class="module-row">
                                        <td class="checkbox-cell">
                                            <input type="checkbox" id="module_${item}" checked>
                                        </td>
                                        <td class="module-name">
                                            ${modules[item]['name']}${keyicon}
                                        </td>
                                        <td class="module-description">
                                            ${modules[item]['descr']}
                                        </td>
                                    </tr>
                                % endif
                            % endfor
                        </tbody>
                    </table>
                    
                    <table class="modern-table data-table" id="typetable" style="display: none">
                        <thead>
                            <tr>
                                <th colspan="4"><i class="fas fa-database"></i> Data Types to Collect</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% count = 0 %>
                            % for item in sorted(types):
                                % if count % 2 == 0:
                                    <tr class="data-type-row">
                                % endif
                                <td class="checkbox-cell">
                                    <input type="checkbox" id="type_${item[1]}" checked>
                                </td>
                                <td class="data-type-name">
                                    ${item[0]}
                                </td>
                                % if not count % 2 == 0:
                                    </tr>
                                % endif
                                <% count = count + 1 %>
                            % endfor
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="action-section">
                <input type="hidden" id='modulelist' name='modulelist' value=''>
                <input type="hidden" id='typelist' name='typelist' value=''>
                <button id="btn-run-scan" class="btn btn-primary btn-large">
                    <i class="fas fa-rocket"></i>
                    Launch Investigation
                </button>
            </div>
        </form>
    </div>
</div>

<script type='text/javascript'>
  if ("${selectedmods}" != "") {
          switchTab("module");

          $("input[id^=module_]").each(function(id, obj) {
              if ("${selectedmods}".indexOf(obj.id.replace("module_", "")) >= 0) {
                  $("#" + obj.id).attr("checked", true);
              } else {
                  $("#" + obj.id).attr("checked", false);
              }
          });
  }
</script>
<%include file="FOOTER.tmpl"/>
